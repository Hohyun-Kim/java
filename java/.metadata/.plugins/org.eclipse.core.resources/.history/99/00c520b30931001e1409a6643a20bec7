package com.ssafy.cartest;

import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.util.ArrayList;
import java.util.List;

public class CarManagerImpl implements CarManager {
  List<Car> list = new ArrayList<Car>();

  // Singleton 구현
  private static CarManager carManager = new CarManagerImpl();

  private CarManagerImpl() {}

  public static CarManager getCarManager() {
    return carManager;
  }

  @Override
  public void add(Car car) throws SameNumberException {
    for (Car carInList : list) {
      if (carInList.getCarNum() == car.getCarNum()) {
        throw new SameNumberException("SameNumberException 발생 : " + car.getCarNum() + "은 이미 등록!!!");
      }
    }
    list.add(car);
  }

  @Override
  public List<Car> search() {
    return list;
  }

  @Override
  public Car searchByNum(int carNum) throws NotFoundException {
    for (Car carInList : list) {
      if (carInList.getCarNum() == carNum) {
        return carInList;
      }
    }
    throw new NotFoundException("NotFoundException 발생 : " + carNum + "은 미등록 차량!!");
  }

  // car.dat list객체 저장
  @Override
  public void save() {
    ObjectOutputStream out = null;
    try {
      out = new ObjectOutputStream(new FileOutputStream("car.dat"));
      out.writeObject(list);
      out.flush();
    } catch (FileNotFoundException e) {
      e.printStackTrace();
    } catch (IOException e) {
      e.printStackTrace();
    } finally {
      out.close();
    }

  }

  @Override
  public List<Car> load() {
    // TODO Auto-generated method stub
    return null;
  }

  @Override
  public void deleteCar(String carName) {

    for (int i = list.size() - 1; i >= 0; i--) {
      if (list.get(i).getCarName().equals(carName)) {
        list.remove(i);
      }
    }

  }

}
